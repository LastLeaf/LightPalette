/**
 * The reveal.js markdown plugin. Handles parsing of
 * markdown inside of presentations as well as loading
 * of external markdown documents.
 */
!function(t,e){"object"==typeof exports?module.exports=e(require("./marked")):(t.RevealMarkdown=e(t.marked),t.RevealMarkdown.initialize())}(this,function(t){function e(t){var e=t.querySelector("script"),a=(e||t).textContent,r=a.match(/^\n?(\s*)/)[1].length,n=a.match(/^\n?(\t*)/)[1].length;return n>0?a=a.replace(new RegExp("\\n?\\t{"+n+"}","g"),"\n"):r>1&&(a=a.replace(new RegExp("\\n? {"+r+"}","g"),"\n")),a}function a(t){for(var e=t.attributes,a=[],r=0,n=e.length;n>r;r++){var i=e[r].name,o=e[r].value;/data\-(markdown|separator|vertical|notes)/gi.test(i)||a.push(o?i+"="+o:i)}return a.join(" ")}function r(t){return t=t||{},t.separator=t.separator||u,t.notesSeparator=t.notesSeparator||c,t.attributes=t.attributes||"",t}function n(t,e){e=r(e);var a=t.split(new RegExp(e.notesSeparator,"mgi"));return 2===a.length&&(t=a[0]+'<aside class="notes" data-markdown>'+a[1].trim()+"</aside>"),'<script type="text/template">'+t+"</script>"}function i(t,e){e=r(e);for(var a,i,o,s=new RegExp(e.separator+(e.verticalSeparator?"|"+e.verticalSeparator:""),"mg"),d=new RegExp(e.separator),l=0,u=!0,c=[];a=s.exec(t);)notes=null,i=d.test(a[0]),!i&&u&&c.push([]),o=t.substring(l,a.index),i&&u?c.push(o):c[c.length-1].push(o),l=s.lastIndex,u=i;(u?c:c[c.length-1]).push(t.substring(l));for(var h="",p=0,m=c.length;m>p;p++)c[p]instanceof Array?(h+="<section "+e.attributes+">",c[p].forEach(function(t){h+="<section data-markdown>"+n(t,e)+"</section>"}),h+="</section>"):h+="<section "+e.attributes+" data-markdown>"+n(c[p],e)+"</section>";return h}function o(){for(var t,r=document.querySelectorAll("[data-markdown]"),o=0,s=r.length;s>o;o++)if(t=r[o],t.getAttribute("data-markdown").length){var d=new XMLHttpRequest,l=t.getAttribute("data-markdown");datacharset=t.getAttribute("data-charset"),null!=datacharset&&""!=datacharset&&d.overrideMimeType("text/html; charset="+datacharset),d.onreadystatechange=function(){4===d.readyState&&(t.outerHTML=d.status>=200&&d.status<300?i(d.responseText,{separator:t.getAttribute("data-separator"),verticalSeparator:t.getAttribute("data-vertical"),notesSeparator:t.getAttribute("data-notes"),attributes:a(t)}):'<section data-state="alert">ERROR: The attempt to fetch '+l+" failed with HTTP status "+d.status+".Check your browser's JavaScript console for more details.<p>Remember that you need to serve the presentation HTML from a HTTP server.</p></section>")},d.open("GET",l,!1);try{d.send()}catch(u){alert("Failed to get the Markdown file "+l+". Make sure that the presentation and the file are served by a HTTP server and the file can be found there. "+u)}}else t.getAttribute("data-separator")||t.getAttribute("data-vertical")||t.getAttribute("data-notes")?t.outerHTML=i(e(t),{separator:t.getAttribute("data-separator"),verticalSeparator:t.getAttribute("data-vertical"),notesSeparator:t.getAttribute("data-notes"),attributes:a(t)}):t.innerHTML=n(e(t))}function s(t,e,a){var r=new RegExp(a,"mg"),n=new RegExp('([^"= ]+?)="([^"=]+?)"',"mg"),i=t.nodeValue;if(matches=r.exec(i)){var o=matches[1];for(i=i.substring(0,matches.index)+i.substring(r.lastIndex),t.nodeValue=i;matchesClass=n.exec(o);)e.setAttribute(matchesClass[1],matchesClass[2]);return!0}return!1}function d(t,e,a,r,n){if(null!=e&&void 0!=e.childNodes&&e.childNodes.length>0){previousParentElement=e;for(var i=0;i<e.childNodes.length;i++){if(childElement=e.childNodes[i],i>0)for(j=i-1;j>=0;){if(aPreviousChildElement=e.childNodes[j],"function"==typeof aPreviousChildElement.setAttribute&&"BR"!=aPreviousChildElement.tagName){previousParentElement=aPreviousChildElement;break}j-=1}parentSection=t,"section"==childElement.nodeName&&(parentSection=childElement,previousParentElement=childElement),("function"==typeof childElement.setAttribute||childElement.nodeType==Node.COMMENT_NODE)&&d(parentSection,childElement,previousParentElement,r,n)}}e.nodeType==Node.COMMENT_NODE&&0==s(e,a,r)&&s(e,t,n)}function l(){for(var a=document.querySelectorAll("[data-markdown]"),r=0,n=a.length;n>r;r++){var i=a[r];if(!i.getAttribute("data-markdown-parsed")){i.setAttribute("data-markdown-parsed",!0);var o=i.querySelector("aside.notes"),s=e(i);i.innerHTML=t(s),d(i,i,null,i.getAttribute("data-element-attributes")||i.parentNode.getAttribute("data-element-attributes")||h,i.getAttribute("data-attributes")||i.parentNode.getAttribute("data-attributes")||p),o&&i.appendChild(o)}}}if("undefined"==typeof t)throw"The reveal.js Markdown plugin requires marked to be loaded";"undefined"!=typeof hljs&&t.setOptions({highlight:function(t,e){return hljs.highlightAuto(t,e).value}});var u="^\n---\n$",c="note:",h="\\.element\\s*?(.+?)$",p="\\.slide:\\s*?(\\S.+?)$";return{initialize:function(){o(),l()},processSlides:o,convertSlides:l,slidify:i}});
