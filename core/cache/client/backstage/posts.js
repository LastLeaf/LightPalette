// Copyright 2014 LastLeaf, LICENSE: github.lastleaf.me/MIT
"use strict";var POST_LIST_LEN=20;fw.main(function(t){var e=t.tmpl,a=e.i18n,i=function(){if(!t.destroyed){var i=lp.backstage.userInfo;if(i._id){var r=$("#content").html(e.main()),n=r.find(".table"),o=lp.tableBuilder(n,{idCol:"_id",editMore:!0},[{id:"title",name:a("Title"),input:"add"},{id:"type",name:a("Type"),input:"add"},{id:"author.displayName",name:a("Author"),input:"add"},{id:"status",name:a("Status"),input:"add"},{id:"extra",type:"extra",input:"add"}]).data(function(e){var r={status:"all",from:e*POST_LIST_LEN,count:POST_LIST_LEN};"editor"!==i.type&&"admin"!==i.type&&(r.author=i._id),t.rpc("post:list",r,function(t){o.setTotal(Math.ceil(t.total/POST_LIST_LEN));for(var e=t.rows,i=0;i<t.rows.length;i++){var r=t.rows[i];r.type=lp.driverName(r.type),r.status=a(r.status);var n=[];n.push(r.dateTimeString),r.series&&n.push(r.series.title);for(var s=0;s<r.category.length;s++)n.push(r.category[s].title);r.extra=n.join(" / ")}o.set(e)},function(t){lp.backstage.showError(t)})}).setPage(0,1);o.change(function(t,e){fw.go("post/"+e)}),o.remove(function(e){t.rpc("post:remove",{_id:e},function(){o.removeRow(e)},function(t){lp.backstage.showError(t),o.enableModify(e)})})}}};lp.backstage.userInfo?i():t.parent.parent.on("userInfoReady",i)});
