// Copyright 2014 LastLeaf, LICENSE: github.lastleaf.me/MIT
"use strict";fw.main(function(t){var e=t.tmpl,n=$("#content").html(e.main()),i=n.children(".settings");n.find(".settings_navi").children().click(function(){var t=$(this).attr("for"),e=i.children("[section="+t+"]");i.prop("scrollTop",e.prop("offsetTop")-20)});var r=function(e){var n=$(e);n.find("input,select,textarea").prop("disabled",!0),t.rpc("settings:get",n.find("[name=_key]").val(),function(t){n.find("input,select,textarea").prop("disabled",!1);for(var e in t)n.find("[name="+e+"]").val(t[e])},lp.backstage.showError)};t.rpc("time:listTimezones",function(t){$("[name=timezone]").html(e.timezone(t)),n.find("form").each(function(){r(this)})},lp.backstage.showError),n.find("form").each(function(){var e=$(this);t.form(this,function(){e.find(".error").html(""),e.find(".submit").prop("disabled",!0)},function(){e.find(".submit").prop("disabled",!1)},function(t){e.find(".submit").prop("disabled",!1),lp.backstage.showError(t)})}),n.find(".email_test").click(function(){var n=$(this),i=n.closest("form"),r=i[0];n.prop("disabled",!0);for(var o={},s=0;s<r.elements.length;s++)r.elements[s].name&&(o[r.elements[s].name]=r.elements[s].value);i.find(".error").html(""),n.prop("disabled",!0),t.rpc("settings:testEmail",o,function(t){n.prop("disabled",!1),n.val(e.sentEmail({to:t}))},function(t,e){n.prop("disabled",!1),lp.backstage.showError(t,e)})})});
