// Copyright 2014 LastLeaf, LICENSE: github.lastleaf.me/MIT
"use strict";var POST_LIST_LEN=20;fw.main(function(t){var a=t.tmpl,e=a.i18n,n=function(){if(!t.destroyed){var n=lp.backstage.userInfo;if(n._id){var i=$("#content").html(a.main()),s=i.find(".table"),o=i.find(".stat_time");lp.backstage.statRange?o.val(lp.backstage.statRange):lp.backstage.statRange=o.val(),o.change(function(){lp.backstage.statRange=o.val(),r.setPage(0,1)});var r=lp.tableBuilder(s,{idCol:"_id",editMore:!0,noRemove:!0},[{id:"post.title",name:e("Title"),input:"add"},{id:"post.author.displayName",name:e("Author"),input:"add"},{id:"post.dateTimeString",name:e("Publish Time"),input:"add"},{id:"visits",name:e("Visits"),input:"add"},{id:"extra",type:"extra",input:"add"}]).data(function(a){var e={timeRange:lp.backstage.statRange,from:a*POST_LIST_LEN,count:POST_LIST_LEN};t.rpc("stat:hotPosts",e,function(t){r.setTotal(Math.ceil(t.total/POST_LIST_LEN));for(var a=t.rows,e=0;e<t.rows.length;e++){t.rows[e]}r.set(a)},function(t){lp.backstage.showError(t)})}).setPage(0,1);r.change(function(t,a){fw.go("/backstage/stat/post/"+a)})}}};lp.backstage.userInfo?n():t.parent.on("userInfoReady",n)});
